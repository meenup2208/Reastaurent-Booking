@*@model BookingClassLibrary.Booking*@

@{
    ViewBag.Title = "Index";
}


<meta name="viewport" content="width=device-width" />

<title>Bookings</title>

<script>
            var dataTable;
            $(document).ready(function () {

                dataTable=$('#myBookings').DataTable(

                    {
                        "processing": true,
                        "serverSide": true,
                        "filter": true,
                        "bInfo": false,
                        "order": [0, "asc"],

                        "columnDefs": [
                            { "targets": [0], orderable: false },
                            { "targets": [2], orderable: false },
                            { "targets": [5], orderable: false },
                            { "targets": [7], orderable: false }
                        ],
                        "ajax": {

                            "url": "/Booking/Bookinglist",

                            "type": "POST",

                            "datatype": "json"

                        },

                        "columns": [
                            {
                                
                                render: function (data, type, row, meta) {
                                    return meta.row + meta.settings._iDisplayStart + 1;
                                }
                            },

                            { "data": "Name", "autoWidth": true},

                            { "data": "Phone", "autoWidth": true },

                            { "data": "TypeOfDining", "autoWidth": true },

                            {
                                "data": "Date",
                                "type": "datetime",
                                "render": function (value) {
                                    if (value === null) return "";
                                    var pattern = /Date\(([^)]+)\)/;
                                    var results = pattern.exec(value);
                                    var dt = new Date(parseFloat(results[1]));
                                    return dt.getDate() + "/" + (dt.getMonth() + 1) + "/" + dt.getFullYear()
                                },
                                 "autoWidth": true
                            },

                            { "data": "Time", "autoWidth": true},

                            { "data": "Guest", "autoWidth": true},

                            {
                                "data": "Bookid",
                                "render": function (data, type, full, meta) {
                                    return ('<button class="btn btn-info" onclick="getdata(' + full.Bookid + ')">View</button> <button class="btn btn-warning" onclick="geteditdata(' + full.Bookid + ')">Edit</button>  <button class="btn btn-danger" onclick="deletedata(' + full.Bookid +')">Delete</button>');
                                }, "autoWidth": true
                            },

                        ]

                    });

            });

            function createpopup() {
                $.get("/Booking/Create", { operation: "Create" }, function (result) {
                    
                    $('#modelbody1').html(result);
                    
                    $('#exampleModal').modal('show');
                    
                    var edit = document.getElementById("edit");
                    edit.style.display = 'none';
                    var save_edit = document.getElementById("save_edit");
                    save_edit.style.display = 'none';

                })
            }

            function getdata(id) {
                $.get("/Booking/View", { operation: "View", Bookid: id }, function (result) {

                    $('#modelbody1').html(result);
                    $('#exampleModal').modal('show');
                    
                    var save = document.getElementById("save");
                    save.style.display = 'none';
                    
                    $('#save_edit').prop('disabled','true');

                })
            }

            function geteditdata(id) {
                $.get("/Booking/Edit", { operation: "Edit", Bookid: id }, function (result) {

                    $('#modelbody1').html(result);
                    $('#exampleModal').modal('show');
                    var save = document.getElementById("save");
                    save.style.display = 'none';
                    var edit = document.getElementById("edit");
                    edit.style.visibility = 'hidden';
                    

                })
            }

            function deletedata(id) {
                $.get("/Booking/Delete", { operation: "Delete", Bookid: id }, function (result) {

                    $('#modelbody1').html(result);
                    $('#exampleModal').modal('show');

                })
            }

            function savechanges() {
                var form = $('form[name="operationForm"]');
                var modal = $('#exampleModal');
                nameValidation();
                validateGuest();
                validateTime();
                validatePhone();
                form.validate();
               
                if (!form.valid()) {
                    return;
                }
                else {
                    var data = form.serialize();
                    $.post("/Booking/Create", data, function (result) {
                        if (result) {

                            Swal.fire({
                                position: 'center',
                                icon: 'success',
                                title: 'Booking Created Successfully',
                                showConfirmButton: false,
                                timer: 1500
                            })

                            modal.modal('hide');                            
                            dataTable.ajax.reload();
                        }
                    })
                }
            }

            function save_editedchanges() {
                var form = $('form[name="operationForm"]');
                var modal = $('#exampleModal');
                nameValidation();
                validateGuest();
                validateTime();
                validatePhone();
                form.validate();
                if (!form.valid()) {
                    return;
                }
                else {
                    var data = form.serialize();
                    $.post("/Booking/Edit", data, function (result) {
                        if (result) {
                            Swal.fire({
                                position: 'center',
                                icon: 'success',
                                title: 'Booking Edited Successfully',
                                showConfirmButton: false,
                                timer: 1500
                            })
                            modal.modal('hide');
                            dataTable.ajax.reload();
                        }
                    })
                }
            }

                function deletedataconfirm()
                {

                    var form = $('form[name="delete_form"]');
                    var modal = $('#exampleModal');

                   
                    

                    if (!form.valid()) {
                        return ;
                    }
                    else {
                        var data = form.serialize();
                        
                        $.post("/Booking/Delete", data, function (result) {
                            if (result) {
                                Swal.fire({
                                    position: 'center',
                                    icon: 'success',
                                    title: 'Booking Deleted Successfully',
                                    showConfirmButton: false,
                                    timer: 1500
                                })
                                modal.modal('hide');
                                dataTable.ajax.reload();
                            }
                        })
                    }

                }

    



</script>



<div>
    <br /><br />
    <div>
        <h1 style="text-align:center">RESTAURANT RESERVATION SYSTEM</h1>
        <h1 style="text-align:center">All Bookings</h1>

       

        <div  >

            <button type="button" class="btn btn-success" onclick="createpopup()">
                New Booking
            </button>
        </div>
        
        <br />

        <div >

            <table id="myBookings" class="table" >
                
                <thead class="thead-light">
                    
                    <tr>
                        <th>Sl.No</th>

                        <th>Name</th>

                        <th>Phone</th>

                        <th>Dining Type</th>

                        <th>Date</th>

                        <th>Time (24 Hr Format)</th>

                        <th>Guest</th>

                        <th>Action</th>

                    </tr>

                </thead>

            </table>

        </div>
    </div>
</div>
<div data-backdrop="static" class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" >
    <div class="modal-dialog" role="document">
        <div class="modal-content" id="modelbody1" style="width:90%;" >

        </div>
    </div>

</div>
